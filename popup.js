const setupVideoPopup=()=>{document.body.addEventListener("click",e=>{let t=e.target.closest("img[slot]");if(!t)return;let l=t.getAttribute("slot");window.getNetfleeBySlot(l,e=>{e&&e.length>0&&handleVideoPopup(t,e)})})};function handleVideoPopup(e,t){let l=e.getAttribute("trailer"),s=0,n=0,r=t[s].link,i=t[s].audio,o=e.nextElementSibling?.textContent||"Untitled Video",a=e.getAttribute("saver")||e.src;if(r){let d=r,y=()=>{let p=document.title;document.title=o;let $=document.createElement("div");$.style.position="fixed",$.style.top="0",$.style.left="0",$.style.width="100vw",$.style.height="100vh",$.style.backgroundColor="rgba(0, 0, 0, 0.51)",$.style.backdropFilter="blur(18px)",$.style.color="white",$.style.zIndex="11000",$.style.overflowY="auto",$.style.transform="translateX(100vw)",$.style.transition="transform 0.55s cubic-bezier(0.4,0,0.2,1)",setTimeout(()=>{$.style.transform="translateX(0)"},10);let m=document.createElement("video");m.src=l,m.style.display="block",m.style.background="black",m.style.marginLeft="0",m.style.marginTop="0",m.style.boxShadow="grey 0.2em 0.2em 0.5em",m.style.width="100%",m.style.height="13em",m.poster=a,m.style.objectFit="cover",m.controls=!1,m.autoplay=!0,m.muted=!0,m.addEventListener("click",()=>{m.muted?m.muted=!1:m.muted=!0}),$.appendChild(m);let u=document.createElement("p");if(u.textContent=o,u.style.textAlign="left",u.style.fontSize="20px",u.style.marginTop="0.5em",u.style.color="white",u.style.marginLeft="1em",u.style.width="80%",$.appendChild(u),t.length>1){let g=document.createElement("select");g.style.display="block",g.style.margin="10px 0",g.style.marginLeft="1em",g.style.padding="0.5em",g.style.borderRadius="5px",g.style.backgroundColor="white",g.style.color="black",g.style.border="1px solid #ccc",t.forEach((e,t)=>{let l=document.createElement("option");l.value=t,l.textContent=`Season ${t+1}`,g.appendChild(l)}),g.addEventListener("change",e=>{r=t[s=parseInt(e.target.value,10)].link,i=t[s].audio,n=0,C()}),$.appendChild(g)}let h=document.createElement("button"),f={};try{f=JSON.parse(localStorage.getItem("videoProgress"))||{}}catch(b){f={}}let x=d[0];f[x]&&f[x].progress>0?h.textContent="Resume":h.textContent="Play",h.style.display="block",h.style.marginTop="0.7em",h.style.marginLeft="5%",h.style.width="90%",h.style.padding="1em 2em",h.style.borderRadius="1em",h.style.backgroundColor="white",h.style.color="black",h.style.fontWeight="bolder",h.style.border="none",h.style.cursor="pointer",h.addEventListener("click",()=>{m.pause();let e=t[s].link,l=t[s].audio;c(n,e,l)}),$.appendChild(h);let v=document.createElement("button");if(v.textContent="Add to Wishlist",v.style.display="block",v.style.marginTop="0.7em",v.style.marginLeft="5%",v.style.width="90%",v.style.padding="1em 2em",v.style.borderRadius="1em",v.style.backgroundColor="#ffcc00",v.style.color="black",v.style.fontWeight="bolder",v.style.border="none",v.style.cursor="pointer",v.addEventListener("click",()=>{let t=e.closest("div");if(!t)return;let l=document.querySelector(".watchlist");if(l){let s=Array.from(l.children),n=s.some(e=>e.isEqualNode(t));if(v.textContent="Already Added",!n){let r=t.cloneNode(!0);r.querySelectorAll("button").forEach(e=>e.remove()),l.appendChild(r),v.style.backgroundColor="green",v.textContent="Added";let i=l.innerHTML;localStorage.setItem("watchlist",i)}}}),$.appendChild(v),e.alt&&""!==e.alt.trim()){let _=localStorage.getItem("subscription");if(_){let E=document.createElement("button");E.textContent="Download",E.setAttribute("id","dwnnetflee"),E.style.display="block",E.style.marginTop="0.7em",E.style.marginLeft="5%",E.style.width="90%",E.style.padding="1em 2em",E.style.borderRadius="1em",E.style.backgroundColor="#007bff",E.style.color="white",E.style.fontWeight="bolder",E.style.border="none",E.style.cursor="pointer",E.addEventListener("click",()=>{E.style.backgroundColor="green",E.textContent="Downloading...",window.location.href=e.alt}),$.appendChild(E)}}let k,w=!!t[s]?.for&&"film"===t[s].for;if(!w){function C(){k.innerHTML="";let e=r&&r.length||0,l=t[s]?.title;for(let i=0;i<e;i++){let o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.background="#181818",o.style.borderRadius="0.7em",o.style.boxShadow="0 2px 8px rgba(0,0,0,0.18)",o.style.cursor="pointer",o.style.padding="0.5em 0.7em",o.style.transition="background 0.15s",o.onmouseover=()=>o.style.background="#232323",o.onmouseout=()=>o.style.background="#181818";let d=document.createElement("div");d.style.position="relative",d.style.width="7em",d.style.height="4em",d.style.flexShrink="0",d.style.marginRight="1em";let y=document.createElement("img");y.src=a,y.alt=`Episode ${i+1}`,y.style.width="100%",y.style.height="100%",y.style.display="block",y.style.objectFit="cover",y.style.borderRadius="0.5em",d.appendChild(y);let p=document.createElement("div");p.style.position="absolute",p.style.left="0",p.style.bottom="0",p.style.width="100%",p.style.height="0.35em",p.style.background="#333",p.style.borderRadius="0 0 0.5em 0.5em",p.style.overflow="hidden";let $=0;try{let u=JSON.parse(localStorage.getItem("videoProgress"))||{},g=r[i];u[g]&&g&&($=Math.min(1,(u[g].progress||0)/2400))}catch{}let h=document.createElement("div");h.style.height="100%",h.style.background="#e50914",h.style.width=`${Math.round(100*$)}%`,p.appendChild(h),d.appendChild(p),o.appendChild(d);let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="column",f.style.justifyContent="center";let b=document.createElement("div");Array.isArray(l)&&l[i]?b.textContent=l[i]:b.textContent=`Episode ${i+1}`,b.style.color="#fff",b.style.fontWeight="bold",b.style.fontSize="1.1em",b.style.marginBottom="0.2em",f.appendChild(b),o.appendChild(f),y.addEventListener("click",()=>{m.pause();let e=t[s].link,l=t[s].audio;c(n=i,e,l)}),k.appendChild(o)}}(k=document.createElement("div")).style.display="flex",k.style.flexDirection="column",k.style.gap="0.7em",k.style.marginTop="0.7em",k.style.marginLeft="5%",k.style.width="90%",C(),$.appendChild(k)}let L=document.createElement("p");L.textContent=e.title||o,L.className="description",L.style.marginTop="20px",L.style.marginLeft="3%",L.style.padding="10px",L.style.backgroundColor="rgba(255, 255, 255, 0.1)",L.style.borderRadius="10px",L.style.color="white",L.style.fontSize="14px",L.style.width="90%",$.appendChild(L),(()=>{let e=Array.from(document.querySelectorAll(".box div")),t=e.sort(()=>.5-Math.random()).slice(0,6),l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="1fr 1fr 1fr",l.style.gap="10px",l.style.margin="1em",l.style.width="90%",l.style.marginLeft="5%",l.style.marginBottom="3em",t.forEach(e=>{let t=e.cloneNode(!0);t.style.position="relative",t.style.overflow="hidden",t.style.borderRadius="0.5em",t.style.boxShadow="0 4px 6px rgba(0, 0, 0, 0.1)",t.style.backgroundColor="#000",Array.from(t.children).forEach(e=>{"IMG"!==e.tagName?e.style.display="none":(e.style.width="100%",e.style.height="10em",e.style.objectFit="cover",e.style.borderRadius="0.5em")}),t.addEventListener("click",()=>{document.body.removeChild($);let e=t.getAttribute("slot");if(e){let l=netflee.filter(t=>t.slot===e);l.length>0&&(n=0,r=l[s=0].link,i=l[s].audio,y())}}),l.appendChild(t)}),$.appendChild(l)})();let S=document.createElement("button");S.textContent="\xd7",S.style.position="fixed",S.style.top="2.5em",S.style.right="1em",S.style.padding="10px",S.style.borderRadius="1em",S.style.backgroundColor="red",S.style.color="white",S.style.border="none",S.style.cursor="pointer",S.addEventListener("click",()=>{document.body.removeChild($),document.title=p,window.removeEventListener("popstate",T),history.state&&history.state.previewOpen&&history.back()}),$.appendChild(S),document.body.appendChild($),history.pushState({previewOpen:!0},"");let T=e=>{document.body.contains($)&&S.click()};window.addEventListener("popstate",T)};y();let c=(e,l,r)=>{let i=l[e],y=r?r[e]:null;if(!i){let c=document.getElementById("toast");c&&(c.innerText="Coming Soon",c.style.display="block",setTimeout(()=>{c.style.display="none"},2e3));return}let p=!!t[s]?.download,$=document.createElement("div");$.style.position="fixed",$.setAttribute("class","video-popup"),$.style.top="0",$.style.left="0",$.style.width="100%",$.style.height="100%",$.style.backgroundColor="rgb(0, 0, 0)",$.style.display="flex",$.style.justifyContent="center",$.style.alignItems="center",$.style.zIndex="12000",$.style.transform="rotate(0deg)";let m=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement?screen.orientation&&screen.orientation.lock?screen.orientation.lock("landscape").catch(e=>{console.warn("Failed to lock orientation:",e)}):($.style.transform="rotate(90deg)",$.style.transformOrigin="center"):$.style.transform="rotate(0deg)"};document.addEventListener("fullscreenchange",m),document.addEventListener("webkitfullscreenchange",m),document.addEventListener("mozfullscreenchange",m),document.addEventListener("MSFullscreenChange",m);let u=document.createElement("video");u.src=i,u.preload="auto",u.load(),u.controls=!1,u.autoplay=!0,u.muted=!1,u.style.width="100%",u.style.height="100%",u.poster=a,u.style.margin="0",u.style.position="relative";let g=!1,h=!1;window.addEventListener("offline",()=>{g=!0,h=!0}),window.addEventListener("online",()=>{if(h){u.src=i,u.load();let e=JSON.parse(localStorage.getItem("videoProgress"))||{};e[u.src]&&void 0!==e[u.src].progress&&(u.currentTime=e[u.src].progress),u.play().catch(e=>{}),y&&(f.load(),f.src=y,f.currentTime=u.currentTime,f.play().catch(e=>{})),h=!1,g=!1}});let f=document.createElement("audio");y&&(f.src=y,f.preload="auto",f.load(),f.autoplay=!0,f.muted=!1,f.controls=!1,f.style.display="none",$.appendChild(f),u.addEventListener("play",()=>f.play()),u.addEventListener("pause",()=>f.pause()),u.addEventListener("seeked",()=>f.currentTime=u.currentTime),u.addEventListener("timeupdate",()=>{Math.abs(u.currentTime-f.currentTime)>.3&&(f.currentTime=u.currentTime)}));let b=JSON.parse(localStorage.getItem("videoProgress"))||{};b[i]&&void 0!==b[i].progress&&(u.currentTime=b[i].progress);let x=()=>{if(!isNaN(u.currentTime)&&u.duration>0){let e=JSON.parse(localStorage.getItem("videoProgress"))||{};e[u.src]={progress:u.currentTime},localStorage.setItem("videoProgress",JSON.stringify(e))}},v=()=>{let e=JSON.parse(localStorage.getItem("videoProgress"))||{};e[u.src]&&void 0!==e[u.src].progress&&(u.currentTime=e[u.src].progress)};u.addEventListener("timeupdate",x),u.addEventListener("ended",()=>{let e=JSON.parse(localStorage.getItem("videoProgress"))||{};delete e[u.src],localStorage.setItem("videoProgress",JSON.stringify(e))});let _=document.createElement("div");_.textContent=o,_.style.position="absolute",_.style.top="1em",_.style.left="1em",_.style.color="white",_.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",_.style.fontSize="18px",_.style.fontWeight="bold",_.style.zIndex="15",$.appendChild(_);let E=document.createElement("div");E.style.position="absolute",E.style.bottom="2.5em",E.style.left="2.2em",E.style.color="white",E.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",E.style.fontSize="14px",E.style.fontWeight="bold",E.style.zIndex="15",E.textContent="00:00 / 00:00";let k=e=>{let t=Math.floor(e/3600).toString().padStart(2,"0"),l=Math.floor(e%3600/60).toString().padStart(2,"0"),s=Math.floor(e%60).toString().padStart(2,"0");return`${t}:${l}:${s}`};u.addEventListener("timeupdate",()=>{let e=k(u.currentTime),t=k(u.duration||0);E.textContent=`${e} / ${t}`}),$.appendChild(E);let w=document.createElement("div");w.style.position="absolute",w.style.bottom="10px",w.style.width="100%",w.style.display="flex",w.style.flexDirection="column",w.style.alignItems="center",w.style.zIndex="10";let C=document.createElement("input");C.type="range",C.min="0",C.max="100",C.style.height="0.2em",C.value="0",C.style.width="90%",C.style.filter="drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.75))",C.style.marginBottom="4em",C.addEventListener("input",()=>{u.currentTime=C.value/100*u.duration}),u.addEventListener("timeupdate",()=>{C.value=u.currentTime/u.duration*100}),w.appendChild(C);let L=null;p&&((L=document.createElement("a")).href=i,L.download="",L.target="_blank",L.textContent="Download",L.style.position="absolute",L.style.bottom="1em",L.style.right="2em",L.style.padding="0.5em 1.2em",L.style.backgroundColor="#222",L.style.borderRadius="1em",L.style.color="white",L.style.border="none",L.style.cursor="pointer",L.style.zIndex="30",L.style.boxShadow="2px 2px 8px rgba(0,0,0,0.7)",L.style.display="block",L.title="Download this video",$.appendChild(L));let S=document.createElement("div");S.style.position="absolute",S.style.top="50%",S.style.left="50%",S.style.transform="translate(-50%, -50%)",S.style.display="flex",S.style.alignItems="center",S.style.zIndex="20";let T=document.createElement("button");T.innerHTML='<i class="fi fi-rr-replay-10" style="font-size:2em;"></i>',T.style.marginRight="2em",T.style.padding="10px",T.style.backgroundColor="transparent",T.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",T.style.color="white",T.style.border="none",T.style.cursor="pointer",T.addEventListener("click",()=>{u.currentTime=Math.max(0,u.currentTime-10)}),S.appendChild(T);let z=document.createElement("button");z.innerHTML='<i class="fi fi-sr-pause" style="color:white;font-size:3.5em;"></i>',z.style.margin="5px",z.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",z.style.color="white",z.style.padding="2em",z.style.backgroundColor="transparent",z.style.border="none",z.style.cursor="pointer",z.addEventListener("click",()=>{u.paused?(u.play(),z.innerHTML='<i class="fi fi-sr-pause" style="color:white;font-size:3.5em;"></i>'):(u.pause(),z.innerHTML='<i class="fi fi-sr-play" style="color:white;font-size:3.5em;"></i>')}),S.appendChild(z);let F=document.createElement("button");F.innerHTML='<i class="fi fi-rr-time-forward-ten" style="font-size:2em;"></i>',F.style.marginLeft="2em",F.style.padding="10px",F.style.backgroundColor="transparent",F.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",F.style.color="white",F.style.border="none",F.style.cursor="pointer",F.addEventListener("click",()=>{u.currentTime=Math.min(u.duration,u.currentTime+10)}),S.appendChild(F);let I=document.createElement("button");I.innerHTML='<i class="fi fi-rr-angle-left" style="font-size:2em;"></i>',I.style.position="absolute",I.style.top="50%",I.style.left="2em",I.style.transform="translateY(-50%)",I.style.padding="10px",I.style.backgroundColor="transparent",I.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",I.style.color="white",I.style.border="none",I.style.cursor="pointer",I.style.zIndex="20",I.addEventListener("click",()=>{n>0&&(R(--n),_.textContent=`${o} - Episode ${n+1}`)}),$.appendChild(I);let M=document.createElement("button");M.innerHTML='<i class="fi fi-rr-angle-right" style="font-size:2em;"></i>',M.style.position="absolute",M.style.top="50%",M.style.right="2em",M.style.transform="translateY(-50%)",M.style.padding="10px",M.style.backgroundColor="transparent",M.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",M.style.color="white",M.style.border="none",M.style.cursor="pointer",M.style.zIndex="20",M.addEventListener("click",()=>{n<l.length-1&&(R(++n),_.textContent=`${o} - Episode ${n+1}`)}),$.appendChild(M),1===d.length&&(I.innerHTML="",M.innerHTML="");let R=e=>{n=e,u.pause(),u.src=l[n],u.load(),y&&r&&(f.pause(),f.src=r[n]||"",f.load()),L&&(L.href=l[n]),v(),u.play()};$.appendChild(u),$.appendChild(S),$.appendChild(w),document.body.appendChild($);let A=document.createElement("div");A.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="4.5em" height="4.5em" viewBox="0 0 24 24"><path fill="none" stroke="#fff" stroke-dasharray="16" stroke-dashoffset="16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="16;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></svg>',A.style.position="absolute",A.style.top="50%",A.style.left="50%",A.style.transform="translate(-50%, -50%)",A.style.color="white",A.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",A.style.fontFamily="Arial, sans-serif",A.style.fontSize="20px",A.style.fontWeight="bold",A.style.zIndex="25",A.style.display="none",$.appendChild(A);let H=()=>{A.style.display="block",_.style.display="none",E.style.display="none",w.style.display="none",S.style.display="none",I.style.display="none",M.style.display="none",y&&f.pause()},P=()=>{A.style.display="none",X(),y&&!u.paused&&f.play()};u.addEventListener("waiting",H),u.addEventListener("canplay",P),u.addEventListener("canplaythrough",P),u.readyState<3&&H(),$.requestFullscreen?$.requestFullscreen():$.webkitRequestFullscreen?$.webkitRequestFullscreen():$.mozRequestFullScreen?$.mozRequestFullScreen():$.msRequestFullscreen&&$.msRequestFullscreen();let q=()=>{document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||(u.pause(),u.src="",document.body.contains($)&&document.body.removeChild($),document.removeEventListener("fullscreenchange",q),document.removeEventListener("webkitfullscreenchange",q),document.removeEventListener("mozfullscreenchange",q),document.removeEventListener("MSFullscreenChange",q))};document.addEventListener("fullscreenchange",q),document.addEventListener("webkitfullscreenchange",q),document.addEventListener("mozfullscreenchange",q),document.addEventListener("MSFullscreenChange",q);let N=document.createElement("button");N.innerHTML='<i class="fi fi-rr-cross" style="font-size:2em;"></i>',N.style.position="absolute",N.style.top="1em",N.style.right="1em",N.style.padding="10px",N.style.backgroundColor="transparent",N.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.95)",N.style.color="white",N.style.border="none",N.style.cursor="pointer",N.style.zIndex="20",N.addEventListener("click",()=>{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),document.body.contains($)&&document.body.removeChild($)}),$.appendChild(N);let D=!1,j=document.createElement("button");j.innerHTML='<i class="fi fi-rr-lock" style="font-size:2em;"></i>',j.style.position="absolute",j.style.left="50%",j.style.bottom="5em",j.style.transform="translateX(-50%)",j.style.padding="10px",j.style.backgroundColor="transparent",j.style.textShadow="2px 2px 4px rgba(0, 0, 0, 0.7)",j.style.color="white",j.style.border="none",j.style.cursor="pointer",j.style.zIndex="20",j.style.transition="opacity 0.2s",j.style.opacity="1",j.addEventListener("click",e=>{e.stopPropagation(),(D=!D)?(j.innerHTML='<i class="fi fi-sr-lock" style="font-size:2em;"></i>',B=null,W()):(j.innerHTML='<i class="fi fi-rr-lock" style="font-size:2em;"></i>',X())}),$.appendChild(j);let B,W=()=>{u.paused||(_.style.display="none",E.style.display="none",w.style.display="none",S.style.display="none",I.style.display="none",M.style.display="none",N.style.display="none",L&&(L.style.display="none"),j.style.opacity="0")},X=()=>{D||"block"===A.style.display?(j.style.opacity="1",_.style.display="none",E.style.display="none",w.style.display="none",S.style.display="none",I.style.display="none",M.style.display="none",N.style.display="none",L&&(L.style.display="none")):(_.style.display="block",E.style.display="block",w.style.display="flex",S.style.display="flex",I.style.display="block",M.style.display="block",N.style.display="block",L&&(L.style.display="block"),j.style.opacity="1",V())},V=()=>{clearTimeout(B),B=setTimeout(W,2e3)};$.addEventListener("mousemove",()=>{D?j.style.opacity="1":X(),V()}),$.addEventListener("click",()=>{D?j.style.opacity="1":X(),V()}),$.addEventListener("touchstart",()=>{D?j.style.opacity="1":X(),V()}),V(),u.addEventListener("pause",()=>{X(),clearTimeout(B)}),u.addEventListener("play",()=>{V()}),$.addEventListener("dblclick",e=>{if(D)return;let t=u.getBoundingClientRect(),l=e.clientX-t.left;l<t.width/2?T.click():F.click()});let Y=null,O=!1,G=(e,t)=>{let l=e.clientX-t.clientX,s=e.clientY-t.clientY;return Math.sqrt(l*l+s*s)},U=e=>{2===e.touches.length&&(Y=G(e.touches[0],e.touches[1]))},J=e=>{if(2===e.touches.length&&null!==Y){let t=G(e.touches[0],e.touches[1]);t>1.2*Y?(O||(u.style.objectFit="cover",O=!0),Y=t):t<.8*Y&&(O&&(u.style.objectFit="contain",O=!1),Y=t)}},K=()=>{Y=null};u.addEventListener("touchstart",U),u.addEventListener("touchmove",J),u.addEventListener("touchend",K),u.addEventListener("touchcancel",K)}}}function waitForNetfleeDataAndInit(){if("function"==typeof window.getNetfleeBySlot){setupVideoPopup();let e=document.querySelector(".watchlist");if(e){let t=localStorage.getItem("watchlist");t&&(e.innerHTML=t)}}else setTimeout(waitForNetfleeDataAndInit,50)}document.addEventListener("DOMContentLoaded",waitForNetfleeDataAndInit);